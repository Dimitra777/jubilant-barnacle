<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç—ã –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 50%, #e1f5fe 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 2rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 1rem;
        }

        .header h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #4a5568;
            font-size: 1.1rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .test-results {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .test-group {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .test-group h3 {
            color: #2d3748;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            border-left: 4px solid #667eea;
            padding-left: 1rem;
        }

        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }

        .test-item:hover {
            background: rgba(255, 255, 255, 0.8);
        }

        .test-description {
            flex: 1;
            font-weight: 500;
            color: #4a5568;
        }

        .test-status {
            padding: 0.25rem 0.75rem;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.9rem;
            min-width: 80px;
            text-align: center;
        }

        .test-status.pending {
            background: #e2e8f0;
            color: #718096;
        }

        .test-status.running {
            background: #feebc8;
            color: #c05621;
            animation: pulse 1s infinite;
        }

        .test-status.passed {
            background: #c6f6d5;
            color: #2f855a;
        }

        .test-status.failed {
            background: #fed7d7;
            color: #c53030;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            margin-top: 2rem;
        }

        .summary h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .summary-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .log {
            background: #1a202c;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 1rem;
        }

        .log-entry {
            margin: 0.25rem 0;
            padding: 0.25rem;
        }

        .log-entry.error {
            color: #fed7d7;
        }

        .log-entry.success {
            color: #c6f6d5;
        }

        .log-entry.info {
            color: #bee3f8;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }
            
            .test-container {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .summary-stats {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="header">
            <h1>üßÆ –¢–µ—Å—Ç—ã –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞</h1>
            <p>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –æ–ø–µ—Ä–∞—Ü–∏–π</p>
        </div>

        <div class="controls">
            <button class="btn" id="run-all-tests">–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
            <button class="btn secondary" id="run-basic-tests">–û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</button>
            <button class="btn secondary" id="run-advanced-tests">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</button>
            <button class="btn secondary" id="clear-results">–û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        </div>

        <div class="test-results" id="test-results">
            <!-- –¢–µ—Å—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>

        <div class="summary" id="summary" style="display: none;">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            <div class="summary-stats">
                <div class="stat">
                    <div class="stat-number" id="total-tests">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="passed-tests">0</div>
                    <div class="stat-label">–ü—Ä–æ–π–¥–µ–Ω–æ</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="failed-tests">0</div>
                    <div class="stat-label">–ù–µ—É–¥–∞—á–Ω–æ</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="success-rate">0%</div>
                    <div class="stat-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                </div>
            </div>
            <div class="log" id="test-log"></div>
        </div>
    </div>

    <script>
        /**
         * –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
         */
        class CalculatorTester {
            constructor() {
                this.tests = [];
                this.results = {
                    total: 0,
                    passed: 0,
                    failed: 0,
                    errors: []
                };
                this.isRunning = false;
                
                this.setupTests();
                this.setupUI();
            }

            setupUI() {
                document.getElementById('run-all-tests').addEventListener('click', () => this.runAllTests());
                document.getElementById('run-basic-tests').addEventListener('click', () => this.runTestGroup('basic'));
                document.getElementById('run-advanced-tests').addEventListener('click', () => this.runTestGroup('advanced'));
                document.getElementById('clear-results').addEventListener('click', () => this.clearResults());
                
                this.renderTests();
            }

            setupTests() {
                // –ë–∞–∑–æ–≤—ã–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
                this.addTestGroup('basic', '–û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏', [
                    {
                        name: '–°–ª–æ–∂–µ–Ω–∏–µ —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª',
                        description: '5 + 3 = 8',
                        test: () => this.testCalculation('5+3', '8')
                    },
                    {
                        name: '–í—ã—á–∏—Ç–∞–Ω–∏–µ',
                        description: '10 - 4 = 6',
                        test: () => this.testCalculation('10-4', '6')
                    },
                    {
                        name: '–£–º–Ω–æ–∂–µ–Ω–∏–µ',
                        description: '7 √ó 6 = 42',
                        test: () => this.testCalculation('7*6', '42')
                    },
                    {
                        name: '–î–µ–ª–µ–Ω–∏–µ',
                        description: '15 √∑ 3 = 5',
                        test: () => this.testCalculation('15/3', '5')
                    },
                    {
                        name: '–î–µ–ª–µ–Ω–∏–µ —Å –¥–µ—Å—è—Ç–∏—á–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º',
                        description: '7 √∑ 2 = 3,5',
                        test: () => this.testCalculation('7/2', '3,5')
                    },
                    {
                        name: '–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –Ω—É–ª–µ–º',
                        description: '5 + 0 = 5',
                        test: () => this.testCalculation('5+0', '5')
                    },
                    {
                        name: '–£–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å',
                        description: '5 √ó 0 = 0',
                        test: () => this.testCalculation('5*0', '0')
                    },
                    {
                        name: '–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞',
                        description: '-5 + 3 = -2',
                        test: () => this.testCalculation('-5+3', '-2')
                    },
                    {
                        name: '–î–µ—Å—è—Ç–∏—á–Ω—ã–µ —á–∏—Å–ª–∞',
                        description: '2,5 + 1,5 = 4',
                        test: () => this.testCalculation('2.5+1.5', '4')
                    },
                    {
                        name: '–°–ª–æ–∂–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è',
                        description: '2 + 3 √ó 4 = 14',
                        test: () => this.testCalculation('2+3*4', '14')
                    }
                ]);

                // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
                this.addTestGroup('advanced', '–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏', [
                    {
                        name: '–ö–≤–∞–¥—Ä–∞—Ç —á–∏—Å–ª–∞',
                        description: 'sqr(5) = 25',
                        test: () => this.testFunction('square', 5, 25)
                    },
                    {
                        name: '–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –∫–æ—Ä–µ–Ω—å',
                        description: '‚àö16 = 4',
                        test: () => this.testFunction('sqrt', 16, 4)
                    },
                    {
                        name: '–û–±—Ä–∞—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ',
                        description: '1/4 = 0,25',
                        test: () => this.testFunction('reciprocal', 4, 0.25)
                    },
                    {
                        name: '–ü—Ä–æ—Ü–µ–Ω—Ç—ã',
                        description: '50% = 0,5',
                        test: () => this.testFunction('percent', 50, 0.5)
                    },
                    {
                        name: '–ö–æ—Ä–µ–Ω—å –∏–∑ –¥–µ—Å—è—Ç–∏—á–Ω–æ–≥–æ',
                        description: '‚àö2,25 = 1,5',
                        test: () => this.testFunction('sqrt', 2.25, 1.5)
                    },
                    {
                        name: '–ö–≤–∞–¥—Ä–∞—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–≥–æ',
                        description: 'sqr(-3) = 9',
                        test: () => this.testFunction('square', -3, 9)
                    }
                ]);

                // –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –∏ –æ—à–∏–±–∫–∏
                this.addTestGroup('edge-cases', '–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏', [
                    {
                        name: '–î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å',
                        description: '–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å',
                        test: () => this.testError('5/0')
                    },
                    {
                        name: '–ö–æ—Ä–µ–Ω—å –∏–∑ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–≥–æ',
                        description: '–û–±—Ä–∞–±–æ—Ç–∫–∞ ‚àö(-4)',
                        test: () => this.testErrorFunction('sqrt', -4)
                    },
                    {
                        name: '–û–±—Ä–∞—Ç–Ω–æ–µ –æ—Ç –Ω—É–ª—è',
                        description: '–û–±—Ä–∞–±–æ—Ç–∫–∞ 1/0',
                        test: () => this.testErrorFunction('reciprocal', 0)
                    },
                    {
                        name: '–û—á–µ–Ω—å –±–æ–ª—å—à–∏–µ —á–∏—Å–ª–∞',
                        description: '999999 √ó 999999',
                        test: () => this.testCalculation('999999*999999', '999998000001')
                    },
                    {
                        name: '–û—á–µ–Ω—å –º–∞–ª—ã–µ —á–∏—Å–ª–∞',
                        description: '0,000001 √ó 1000000 = 1',
                        test: () => this.testCalculation('0.000001*1000000', '1')
                    }
                ]);

                // –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã
                this.addTestGroup('interface', '–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å', [
                    {
                        name: '–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞',
                        description: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–º–µ–Ω—ã —Ç–æ—á–∫–∏ –Ω–∞ –∑–∞–ø—è—Ç—É—é',
                        test: () => this.testFormatting()
                    },
                    {
                        name: '–û—á–∏—Å—Ç–∫–∞ –¥–∏—Å–ø–ª–µ—è',
                        description: '–§—É–Ω–∫—Ü–∏—è Clear (C)',
                        test: () => this.testClear()
                    },
                    {
                        name: '–£–¥–∞–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞',
                        description: '–§—É–Ω–∫—Ü–∏—è Backspace',
                        test: () => this.testBackspace()
                    },
                    {
                        name: '–í–≤–æ–¥ –¥–µ—Å—è—Ç–∏—á–Ω–æ–π —Ç–æ—á–∫–∏',
                        description: '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—è—Ç–æ–π',
                        test: () => this.testDecimalInput()
                    }
                ]);
            }

            addTestGroup(id, name, tests) {
                const group = { id, name, tests };
                this.tests.push(group);
            }

            renderTests() {
                const container = document.getElementById('test-results');
                container.innerHTML = '';

                this.tests.forEach(group => {
                    const groupElement = document.createElement('div');
                    groupElement.className = 'test-group';
                    groupElement.innerHTML = `
                        <h3>${group.name} (${group.tests.length} —Ç–µ—Å—Ç–æ–≤)</h3>
                        ${group.tests.map(test => `
                            <div class="test-item" data-test-id="${test.name}">
                                <div class="test-description">${test.description}</div>
                                <div class="test-status pending" id="status-${this.sanitizeId(test.name)}">–û–∂–∏–¥–∞–Ω–∏–µ</div>
                            </div>
                        `).join('')}
                    `;
                    container.appendChild(groupElement);
                });
            }

            async runAllTests() {
                if (this.isRunning) return;
                
                this.clearResults();
                this.isRunning = true;
                this.log('–ù–∞—á–∏–Ω–∞–µ–º –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞...', 'info');

                for (const group of this.tests) {
                    this.log(`\n=== ${group.name} ===`, 'info');
                    await this.runTestGroup(group.id);
                }

                this.showSummary();
                this.isRunning = false;
            }

            async runTestGroup(groupId) {
                const group = this.tests.find(g => g.id === groupId);
                if (!group) return;

                this.log(`–ó–∞–ø—É—Å–∫ –≥—Ä—É–ø–ø—ã —Ç–µ—Å—Ç–æ–≤: ${group.name}`, 'info');

                for (const test of group.tests) {
                    await this.runSingleTest(test);
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ª—É—á—à–µ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
                    await this.delay(100);
                }
            }

            async runSingleTest(test) {
                const statusElement = document.getElementById(`status-${this.sanitizeId(test.name)}`);
                
                try {
                    statusElement.className = 'test-status running';
                    statusElement.textContent = '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ';
                    
                    const result = await test.test();
                    
                    if (result.success) {
                        statusElement.className = 'test-status passed';
                        statusElement.textContent = '–ü—Ä–æ–π–¥–µ–Ω';
                        this.results.passed++;
                        this.log(`‚úì ${test.name}: ${test.description}`, 'success');
                    } else {
                        statusElement.className = 'test-status failed';
                        statusElement.textContent = '–ù–µ—É–¥–∞—á–Ω–æ';
                        this.results.failed++;
                        this.results.errors.push(`${test.name}: ${result.error}`);
                        this.log(`‚úó ${test.name}: ${result.error}`, 'error');
                    }
                } catch (error) {
                    statusElement.className = 'test-status failed';
                    statusElement.textContent = '–û—à–∏–±–∫–∞';
                    this.results.failed++;
                    this.results.errors.push(`${test.name}: ${error.message}`);
                    this.log(`‚úó ${test.name}: –ò—Å–∫–ª—é—á–µ–Ω–∏–µ - ${error.message}`, 'error');
                }
                
                this.results.total++;
            }

            // –ú–µ—Ç–æ–¥—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

            testCalculation(expression, expectedResult) {
                return new Promise((resolve) => {
                    try {
                        // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                        const calc = this.createTestCalculator();
                        
                        // –í–≤–æ–¥–∏–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
                        for (let char of expression) {
                            if (char >= '0' && char <= '9') {
                                calc.inputNumber(char);
                            } else if (char === '.') {
                                calc.inputDecimal();
                            } else if (['+', '-', '*', '/'].includes(char)) {
                                calc.inputOperator(char);
                            }
                        }
                        
                        // –í—ã—á–∏—Å–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                        calc.calculate();
                        
                        const result = calc.getCurrentValue().replace(',', '.');
                        const expected = expectedResult.replace(',', '.');
                        
                        if (Math.abs(parseFloat(result) - parseFloat(expected)) < 0.0001) {
                            resolve({ success: true });
                        } else {
                            resolve({ 
                                success: false, 
                                error: `–û–∂–∏–¥–∞–ª—Å—è ${expectedResult}, –ø–æ–ª—É—á–µ–Ω ${calc.getCurrentValue()}`
                            });
                        }
                    } catch (error) {
                        resolve({ success: false, error: error.message });
                    }
                });
            }

            testFunction(functionName, input, expectedOutput) {
                return new Promise((resolve) => {
                    try {
                        const calc = this.createTestCalculator();
                        calc.setDisplay(input.toString());
                        
                        // –í—ã–ø–æ–ª–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é
                        switch (functionName) {
                            case 'square':
                                calc.square();
                                break;
                            case 'sqrt':
                                calc.sqrt();
                                break;
                            case 'reciprocal':
                                calc.reciprocal();
                                break;
                            case 'percent':
                                calc.percent();
                                break;
                        }
                        
                        const result = parseFloat(calc.getCurrentValue().replace(',', '.'));
                        
                        if (Math.abs(result - expectedOutput) < 0.0001) {
                            resolve({ success: true });
                        } else {
                            resolve({ 
                                success: false, 
                                error: `–û–∂–∏–¥–∞–ª—Å—è ${expectedOutput}, –ø–æ–ª—É—á–µ–Ω ${result}`
                            });
                        }
                    } catch (error) {
                        resolve({ success: false, error: error.message });
                    }
                });
            }

            testError(expression) {
                return new Promise((resolve) => {
                    try {
                        const calc = this.createTestCalculator();
                        
                        // –í–≤–æ–¥–∏–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
                        for (let char of expression) {
                            if (char >= '0' && char <= '9') {
                                calc.inputNumber(char);
                            } else if (['+', '-', '*', '/'].includes(char)) {
                                calc.inputOperator(char);
                            }
                        }
                        
                        calc.calculate();
                        const result = calc.getCurrentValue();
                        
                        if (result === '–û—à–∏–±–∫–∞' || result.includes('Infinity')) {
                            resolve({ success: true });
                        } else {
                            resolve({ success: false, error: `–û–∂–∏–¥–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞, –ø–æ–ª—É—á–µ–Ω ${result}` });
                        }
                    } catch (error) {
                        resolve({ success: true }); // –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è
                    }
                });
            }

            testErrorFunction(functionName, input) {
                return new Promise((resolve) => {
                    try {
                        const calc = this.createTestCalculator();
                        calc.setDisplay(input.toString());
                        
                        // –ú–æ–∫–∞–µ–º toast –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –æ—à–∏–±–æ–∫
                        let errorCaught = false;
                        const originalToast = window.toast;
                        window.toast = {
                            error: () => { errorCaught = true; }
                        };
                        
                        switch (functionName) {
                            case 'sqrt':
                                calc.sqrt();
                                break;
                            case 'reciprocal':
                                calc.reciprocal();
                                break;
                        }
                        
                        window.toast = originalToast;
                        
                        if (errorCaught) {
                            resolve({ success: true });
                        } else {
                            resolve({ success: false, error: '–û–∂–∏–¥–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞' });
                        }
                    } catch (error) {
                        resolve({ success: true });
                    }
                });
            }

            testFormatting() {
                return new Promise((resolve) => {
                    try {
                        const calc = this.createTestCalculator();
                        const formatted = calc.formatNumber(3.14159);
                        
                        if (formatted === '3,14159') {
                            resolve({ success: true });
                        } else {
                            resolve({ success: false, error: `–ù–µ–≤–µ—Ä–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: ${formatted}` });
                        }
                    } catch (error) {
                        resolve({ success: false, error: error.message });
                    }
                });
            }

            testClear() {
                return new Promise((resolve) => {
                    try {
                        const calc = this.createTestCalculator();
                        calc.inputNumber('5');
                        calc.inputOperator('+');
                        calc.inputNumber('3');
                        calc.clear();
                        
                        if (calc.getCurrentValue() === '0') {
                            resolve({ success: true });
                        } else {
                            resolve({ success: false, error: '–î–∏—Å–ø–ª–µ–π –Ω–µ –æ—á–∏—â–µ–Ω' });
                        }
                    } catch (error) {
                        resolve({ success: false, error: error.message });
                    }
                });
            }

            testBackspace() {
                return new Promise((resolve) => {
                    try {
                        const calc = this.createTestCalculator();
                        calc.inputNumber('1');
                        calc.inputNumber('2');
                        calc.inputNumber('3');
                        calc.backspace();
                        
                        if (calc.getCurrentValue() === '12') {
                            resolve({ success: true });
                        } else {
                            resolve({ success: false, error: `–ù–µ–≤–µ—Ä–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${calc.getCurrentValue()}` });
                        }
                    } catch (error) {
                        resolve({ success: false, error: error.message });
                    }
                });
            }

            testDecimalInput() {
                return new Promise((resolve) => {
                    try {
                        const calc = this.createTestCalculator();
                        calc.inputNumber('3');
                        calc.inputDecimal();
                        calc.inputNumber('14');
                        
                        if (calc.getCurrentValue() === '3,14') {
                            resolve({ success: true });
                        } else {
                            resolve({ success: false, error: `–ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥: ${calc.getCurrentValue()}` });
                        }
                    } catch (error) {
                        resolve({ success: false, error: error.message });
                    }
                });
            }

            // –£—Ç–∏–ª–∏—Ç—ã

            createTestCalculator() {
                // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                return new (class TestCalculator {
                    constructor() {
                        this.currentExpression = '';
                        this.previousResult = 0;
                        this.shouldResetDisplay = false;
                    }
                    
                    inputNumber(number) {
                        if (this.shouldResetDisplay) {
                            this.currentExpression = '';
                            this.shouldResetDisplay = false;
                        }
                        
                        if (this.currentExpression === '0' && number === '0') return;
                        
                        if (this.currentExpression === '0' && number !== '0') {
                            this.currentExpression = number;
                        } else {
                            this.currentExpression += number;
                        }
                    }
                    
                    inputOperator(operator) {
                        if (this.currentExpression === '') {
                            this.currentExpression = this.previousResult.toString();
                        }
                        
                        if (this.isLastCharOperator()) {
                            this.currentExpression = this.currentExpression.slice(0, -1) + operator;
                        } else {
                            this.currentExpression += operator;
                        }
                    }
                    
                    inputDecimal() {
                        if (this.shouldResetDisplay) {
                            this.currentExpression = '0';
                            this.shouldResetDisplay = false;
                        }
                        
                        const parts = this.currentExpression.split(/[+\-*/]/);
                        const lastPart = parts[parts.length - 1];
                        
                        if (!lastPart.includes('.')) {
                            if (this.currentExpression === '' || this.isLastCharOperator()) {
                                this.currentExpression += '0.';
                            } else {
                                this.currentExpression += '.';
                            }
                        }
                    }
                    
                    calculate() {
                        if (this.currentExpression === '') return;
                        
                        try {
                            const expression = this.currentExpression;
                            
                            if (this.isValidExpression(expression)) {
                                const result = this.evaluateExpression(expression);
                                
                                if (isNaN(result) || !isFinite(result)) {
                                    throw new Error('–ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç');
                                }
                                
                                this.previousResult = result;
                                this.currentExpression = this.formatNumber(result);
                                this.shouldResetDisplay = true;
                            } else {
                                throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ');
                            }
                        } catch (error) {
                            this.currentExpression = '–û—à–∏–±–∫–∞';
                        }
                    }
                    
                    square() {
                        const currentValue = this.getCurrentNumber();
                        if (currentValue !== null) {
                            const result = currentValue * currentValue;
                            this.replaceCurrentNumber(result);
                        }
                    }
                    
                    sqrt() {
                        const currentValue = this.getCurrentNumber();
                        if (currentValue !== null) {
                            if (currentValue < 0) {
                                throw new Error('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–≤–ª–µ—á—å –∫–æ—Ä–µ–Ω—å –∏–∑ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞');
                            }
                            const result = Math.sqrt(currentValue);
                            this.replaceCurrentNumber(result);
                        }
                    }
                    
                    reciprocal() {
                        const currentValue = this.getCurrentNumber();
                        if (currentValue !== null) {
                            if (currentValue === 0) {
                                throw new Error('–î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ');
                            }
                            const result = 1 / currentValue;
                            this.replaceCurrentNumber(result);
                        }
                    }
                    
                    percent() {
                        const currentValue = this.getCurrentNumber();
                        if (currentValue !== null) {
                            const result = currentValue / 100;
                            this.replaceCurrentNumber(result);
                        }
                    }
                    
                    clear() {
                        this.currentExpression = '';
                        this.previousResult = 0;
                        this.shouldResetDisplay = false;
                    }
                    
                    backspace() {
                        if (this.currentExpression.length > 0) {
                            this.currentExpression = this.currentExpression.slice(0, -1);
                        }
                    }
                    
                    getCurrentValue() {
                        return this.currentExpression || '0';
                    }
                    
                    setDisplay(value) {
                        this.currentExpression = value;
                        this.shouldResetDisplay = true;
                    }
                    
                    getCurrentNumber() {
                        const parts = this.currentExpression.split(/[+\-*/]/);
                        const lastPart = parts[parts.length - 1];
                        const number = parseFloat(lastPart);
                        return isNaN(number) ? null : number;
                    }
                    
                    replaceCurrentNumber(newNumber) {
                        const formattedNumber = this.formatNumber(newNumber);
                        const parts = this.currentExpression.split(/([+\-*/])/);
                        parts[parts.length - 1] = formattedNumber;
                        this.currentExpression = parts.join('');
                    }
                    
                    isLastCharOperator() {
                        const lastChar = this.currentExpression.slice(-1);
                        return ['+', '-', '*', '/'].includes(lastChar);
                    }
                    
                    isValidExpression(expression) {
                        return expression !== '' && !this.isLastCharOperator();
                    }
                    
                    evaluateExpression(expression) {
                        return Function(`"use strict"; return (${expression})`)();
                    }
                    
                    formatNumber(number) {
                        if (typeof number !== 'number' || isNaN(number)) return '0';
                        const rounded = Math.round(number * 10000000000) / 10000000000;
                        return rounded.toString().replace('.', ',');
                    }
                })();
            }

            // UI —É—Ç–∏–ª–∏—Ç—ã

            clearResults() {
                this.results = { total: 0, passed: 0, failed: 0, errors: [] };
                
                document.querySelectorAll('.test-status').forEach(status => {
                    status.className = 'test-status pending';
                    status.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ';
                });
                
                document.getElementById('summary').style.display = 'none';
                document.getElementById('test-log').innerHTML = '';
            }

            showSummary() {
                const summaryElement = document.getElementById('summary');
                const successRate = this.results.total > 0 
                    ? Math.round((this.results.passed / this.results.total) * 100) 
                    : 0;
                
                document.getElementById('total-tests').textContent = this.results.total;
                document.getElementById('passed-tests').textContent = this.results.passed;
                document.getElementById('failed-tests').textContent = this.results.failed;
                document.getElementById('success-rate').textContent = `${successRate}%`;
                
                summaryElement.style.display = 'block';
                
                if (successRate === 100) {
                    this.log('\nüéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!', 'success');
                } else {
                    this.log(`\n‚ö†Ô∏è  ${this.results.failed} —Ç–µ—Å—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å –Ω–µ—É–¥–∞—á–µ–π`, 'error');
                }
            }

            log(message, type = 'info') {
                const logElement = document.getElementById('test-log');
                const entry = document.createElement('div');
                entry.className = `log-entry ${type}`;
                entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                logElement.appendChild(entry);
                logElement.scrollTop = logElement.scrollHeight;
            }

            sanitizeId(str) {
                return str.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞
        document.addEventListener('DOMContentLoaded', () => {
            window.tester = new CalculatorTester();
            console.log('üß™ –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –≥–æ—Ç–æ–≤–∞');
        });
    </script>
</body>
</html>